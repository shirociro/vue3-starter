import{r as u,c as C,o as w,a as e,d as I,j as Z,g as _,v as V,_ as O,k as h,b as q,q as ee,m as Q,p as K,x as te,n as oe,w as ae,G as X,l as ne,t as se,H as ie,s as J,T as re,y as ue,i as de,z as ce}from"./index-C-Wx4nDS.js";import{s as me,l as pe,_ as fe}from"./index-CYn1xYCC.js";import{u as j,s as ve,c as ge,a as be,d as ye,_ as ke}from"./StacksList-Cw91u0pg.js";import{g as xe,u as G,a as R}from"./Loading-D7qaePDp.js";import"./usersStore-CzbIz2Pa.js";const we={class:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 pb-4 flex-wrap"},Se={class:"d-flex align-items-center gap-2 flex-shrink-0"},Ce={class:"d-flex flex-wrap gap-2 justify-content-end align-items-center flex-grow-1"},$e={class:"d-flex align-items-center gap-2 flex-grow-1 flex-md-grow-0 min-w-0"},Ue={class:"d-flex align-items-center gap-2 flex-grow-1 flex-md-grow-0 min-w-0"},Le={__name:"StackToolbar",setup(i){const d=j(),n=u(d.search);return u("all"),(l,o)=>(w(),C("div",we,[e("div",Se,[o[6]||(o[6]=e("h2",{class:"m-0"},"Stacks",-1)),e("button",{class:"btn btn-primary d-flex justify-content-center align-items-center p-2 rounded-circle",style:{height:"40px",width:"40px"},onClick:o[0]||(o[0]=m=>l.$emit("action","Add")),title:"Add User"},[...o[5]||(o[5]=[e("i",{class:"bi bi-plus-lg fs-4"},null,-1)])])]),e("div",Ce,[e("div",$e,[o[8]||(o[8]=e("label",{class:"form-label m-0"},"Types:",-1)),I(e("select",{class:"form-select flex-grow-1","onUpdate:modelValue":o[1]||(o[1]=m=>_(d).types=m),onChange:o[2]||(o[2]=m=>l.usersStore.setPosition(_(d).types))},[...o[7]||(o[7]=[e("option",{value:"all"},"All",-1),e("option",{value:"1"},"Frontend",-1),e("option",{value:"2"},"Backend",-1),e("option",{value:"3"},"Testing",-1)])],544),[[Z,_(d).types]])]),e("div",Ue,[I(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=m=>n.value=m),onInput:o[4]||(o[4]=m=>_(d).setSearch(n.value)),class:"form-control",placeholder:"Search..."},null,544),[[V,n.value]])])])]))}},Ie={class:"text-center mt-3 mb-3 position-relative",style:{width:"100px",margin:"0 auto"}},Te=["src"],he={__name:"LogoUpload",props:{profile:{type:String,required:!1},mode:{type:String,required:!1}},emits:["update"],setup(i,{emit:d}){const n=u(null),l=u(""),o=d,m=()=>{n.value?.choose()},f=p=>{const c=p.files?.[0];c&&(l.value=URL.createObjectURL(c),o("update",c))},S=p=>{l.value=null,o("update",null)};return(p,c)=>(w(),C("div",Ie,[h(_(me),{ref_key:"fileUpload",ref:n,mode:"basic",accept:"image/*",customUpload:!0,chooseLabel:"",onSelect:f,class:"d-none"},null,512),l.value||i.profile?(w(),C("img",{key:0,src:i.mode=="Edit"&&!l.value?_(xe)(i.profile):l.value,alt:"Profile Avatar",class:"rounded-circle border avatar-img",onClick:m},null,8,Te)):q("",!0),l.value||i.profile?(w(),C("i",{key:1,onClick:c[0]||(c[0]=$=>S()),class:"bi bi-trash-fill text-danger position-absolute",style:{top:"65%",right:"0px",cursor:"pointer","background-color":"white","border-radius":"30%","font-size":"1.2rem",padding:"4px"}})):(w(),C("div",{key:2,class:"rounded-circle border avatar-img d-flex align-items-center justify-content-center bg-light text-secondary",onClick:m},[...c[1]||(c[1]=[e("i",{class:"bi bi-person",style:{"font-size":"4rem"}},null,-1)])]))]))}},Me=O(he,[["__scopeId","data-v-b8ed19a1"]]),Ae={class:"light-editor"},Ve={class:"btn-toolbar mb-0",role:"toolbar","aria-label":"Editor toolbar",id:"light-editor-toolbar"},_e={class:"btn-group me-0",role:"group"},De={key:0,class:"mb-2"},He=["onKeydown"],Ee={key:1,class:"mt-2"},Be={class:"input-group"},Fe={key:2,class:"mt-2"},qe={class:"input-group"},Pe={__name:"Editor",props:{modelValue:{type:String,default:""},sanitize:{type:Boolean,default:!0},maxImageSizeMB:{type:Number,default:5},allowPasteImage:{type:Boolean,default:!0},uploadImage:{type:Function,default:null},customClass:{type:String,default:""}},emits:["update:modelValue","image-upload-failed"],setup(i,{emit:d}){const n=i,l=d,o=u(null),m=u(!1),f=u(n.modelValue||""),S=u(!1),p=u({url:"",text:""}),c=u(!1),$=u({url:"",alt:""});function D(a){if(!a)return"";const r=new DOMParser().parseFromString(a,"text/html");r.querySelectorAll("script,style").forEach(y=>y.remove());const L=["A","P","DIV","BR","B","STRONG","I","EM","U","UL","OL","LI","IMG","H1","H2","H3","H4","SPAN"],F={A:["href","target","rel"],IMG:["src","alt","width","height"],DIV:["class"]};function g(y){const x=y.nodeName;if(y.nodeType!==Node.TEXT_NODE){if(!L.includes(x)){const k=y.parentNode;for(;y.firstChild;)k.insertBefore(y.firstChild,y);y.remove();return}for(const k of Array.from(y.attributes||[]))(!(F[x]&&F[x].includes(k.name)||["class","style"].includes(k.name)&&x==="DIV")||/^on/i.test(k.name)||k.name==="href"&&/^javascript:/i.test(k.value))&&y.removeAttribute(k.name);Array.from(y.childNodes).forEach(g)}}return Array.from(r.body.childNodes).forEach(g),r.body.innerHTML}function H(a){const t=n.sanitize?D(a):a;o.value&&(o.value.innerHTML=t)}ee(()=>{H(n.modelValue)}),Q(()=>n.modelValue,a=>{a!==f.value&&(f.value=a,H(a))});function b(){f.value=o.value.innerHTML,l("update:modelValue",f.value)}function P(){f.value=o.value.innerHTML,l("update:modelValue",f.value)}function M(){H(f.value),l("update:modelValue",f.value)}function E(a){a==="insertUnorderedList"?document.execCommand("insertUnorderedList"):a==="insertOrderedList"?document.execCommand("insertOrderedList"):document.execCommand(a),b()}async function N(a){const t=a.clipboardData||window.clipboardData;if(!t)return;const L=Array.from(t.items||[]).find(g=>g.type&&g.type.startsWith("image/"));if(L&&n.allowPasteImage){a.preventDefault();const g=L.getAsFile();if(!g)return;const y=n.maxImageSizeMB*1024*1024;if(g.size>y){document.execCommand("insertText",!1,`[Image too large: ${(g.size/1024/1024).toFixed(2)} MB]`),b();return}try{if(typeof n.uploadImage=="function"){const x=await n.uploadImage(g),k=typeof x=="string"?x:x&&x.url;if(k)A(k,g.name);else{const W=await T(g);A(W,g.name)}}else{const x=await T(g);A(x,g.name)}}catch(x){l("image-upload-failed",x);try{const k=await T(g);A(k,g.name)}catch{document.execCommand("insertText",!1,"[Image paste failed]"),b()}}return}const F=t.getData("text/plain");F&&(a.preventDefault(),document.execCommand("insertText",!1,F),X(()=>b()))}function T(a){return new Promise((t,r)=>{const L=new FileReader;L.onload=()=>t(L.result),L.onerror=r,L.readAsDataURL(a)})}function A(a,t=""){const r=`<img src="${z(a)}" alt="${z(t)}" />`;document.execCommand("insertHTML",!1,r),X(()=>{b()})}function v(a){document.execCommand("insertText",!1,"  "),b()}function s(){const a=p.value.url.trim();if(!a){S.value=!1;return}const t=p.value.text.trim();t?document.execCommand("insertHTML",!1,`<a href="${z(a)}" target="_blank" rel="noopener noreferrer">${z(t)}</a>`):document.execCommand("createLink",!1,a),S.value=!1,b()}function U(){const a=$.value.url.trim();if(!a){c.value=!1;return}const t=$.value.alt.trim();A(a,t),c.value=!1}function z(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function le(){m.value=!m.value,m.value?f.value=o.value.innerHTML:H(f.value)}return(a,t)=>(w(),C("div",Ae,[e("div",Ve,[e("div",_e,[e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:t[0]||(t[0]=r=>E("bold")),title:"Bold"},[...t[11]||(t[11]=[e("strong",null,"B",-1)])]),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:t[1]||(t[1]=r=>E("italic")),title:"Italic"},[...t[12]||(t[12]=[e("em",null,"I",-1)])]),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=r=>E("underline")),title:"Underline"},[...t[13]||(t[13]=[e("u",null,"U",-1)])]),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:t[3]||(t[3]=r=>E("insertUnorderedList")),title:"Bullet List"}," â€¢ "),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:le,title:"Toggle HTML view"}," HTML ")])]),m.value?(w(),C("div",De,[I(e("textarea",{class:K(["form-control",i.customClass]),rows:"6","onUpdate:modelValue":t[4]||(t[4]=r=>f.value=r),onInput:M},null,34),[[V,f.value]])])):q("",!0),h(_(ve),{style:{width:"100%",height:"250px"}},{default:te(()=>[e("div",{ref_key:"editor",ref:o,class:K(["editor form-control",i.customClass]),contenteditable:"true",role:"textbox","aria-multiline":!0,onInput:b,onPaste:N,onKeydown:oe(ae(v,["prevent"]),["tab"]),onBlur:P},null,42,He)]),_:1}),S.value?(w(),C("div",Ee,[e("div",Be,[I(e("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>p.value.url=r),class:"form-control form-control-sm",placeholder:"https://example.com"},null,512),[[V,p.value.url]]),I(e("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>p.value.text=r),class:"form-control form-control-sm",placeholder:"Link text (optional)"},null,512),[[V,p.value.text]]),e("button",{class:"btn btn-sm btn-primary",onClick:s},"Apply"),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[7]||(t[7]=r=>S.value=!1)}," Cancel ")])])):q("",!0),c.value?(w(),C("div",Fe,[e("div",qe,[I(e("input",{"onUpdate:modelValue":t[8]||(t[8]=r=>$.value.url=r),class:"form-control form-control-sm",placeholder:"Image URL"},null,512),[[V,$.value.url]]),I(e("input",{"onUpdate:modelValue":t[9]||(t[9]=r=>$.value.alt=r),class:"form-control form-control-sm",placeholder:"Alt text"},null,512),[[V,$.value.alt]]),e("button",{class:"btn btn-sm btn-primary",onClick:U}," Insert "),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[10]||(t[10]=r=>c.value=!1)}," Cancel ")])])):q("",!0)]))}},Ne=O(Pe,[["__scopeId","data-v-37f0b821"]]);function ze(){const i=G(),d=R({mutationFn:ge,onSuccess:()=>{i.invalidateQueries({queryKey:["stacks"]})}}),n=R({mutationFn:be,onSuccess:()=>{i.invalidateQueries({queryKey:["stacks"]})}}),l=R({mutationFn:ye,onSuccess:()=>{i.invalidateQueries({queryKey:["stacks"]})}});return{createStack:d,updateStack:n,deleteStack:l}}const Ke={class:"modal-dialog modal-dialog-centered",style:{"max-width":"400px !important"}},Oe={class:"modal-content"},Re={class:"modal-header"},Qe={class:"modal-title"},je={class:"modal-body"},Ge={class:"row gy-2"},We={class:"col-12 d-flex align-items-center"},Xe={class:"col-12 d-flex align-items-center"},Je={class:"col-12 d-flex"},Ye=ne({__name:"ModalForm",props:{mode:{},stackData:{}},emits:["close"],setup(i,{emit:d}){const n=G(),l=i,o=d,m=j(),{createStack:f,updateStack:S}=ze(),p=u(!1),c=u(""),$=u(!0),D=u(""),H=u(!0),b=u(""),P=u(!0),M=u();function E(){const v={id:l.mode==="Edit"?l.stackData.id:void 0,language:c.value,concepts:D.value,type_id:b.value,logo:M.value,remove_logo:p.value};l.mode==="Edit"?S.mutate(v,{onSuccess:s=>{T(),m.glowEffect(v.id),setTimeout(()=>{n.invalidateQueries({queryKey:["stacks"]})},1500)}}):f.mutate(v,{onSuccess:s=>{T()}})}function N(v,s){v||v.length!=0}function T(){o("close")}Q(()=>l.stackData,v=>{c.value=v?.language||"",D.value=v?.concepts||"",b.value=v?.types||"",M.value=v?.logo||""},{immediate:!0});function A(v){v?(M.value=v,p.value=!1):(M.value="",p.value=!0)}return(v,s)=>(w(),C("div",{class:"modal fade show d-block",tabindex:"-1",type:"dialog","aria-modal":"true",style:{"background-color":"rgba(0, 0, 0, 0.5)"},onKeydown:oe(T,["esc"])},[e("div",Ke,[e("div",Oe,[e("div",Re,[e("h5",Qe,se(i.mode)+" Stack",1)]),e("div",je,[e("form",{onSubmit:ae(E,["prevent"])},[h(Me,{onUpdate:A,logo:M.value,mode:i.mode},null,8,["logo","mode"]),e("div",Ge,[e("div",We,[s[5]||(s[5]=e("label",{class:"form-label me-2 mb-0"},"Language",-1)),I(e("input",{"onUpdate:modelValue":s[0]||(s[0]=U=>c.value=U),maxlength:"100",class:K(["form-control flex-fill",{"is-invalid":!$.value}]),placeholder:"",onKeyup:s[1]||(s[1]=U=>N(c.value,$.value))},null,34),[[V,c.value]])]),e("div",Xe,[s[7]||(s[7]=e("label",{class:"form-label me-2 mb-0"},"Type",-1)),I(e("select",{"onUpdate:modelValue":s[2]||(s[2]=U=>b.value=U),class:K(["form-select flex-fill",{"is-invalid":!P.value}]),onChange:s[3]||(s[3]=U=>N(b.value,P.value))},[...s[6]||(s[6]=[ie('<option value="" data-v-a5853f32>Select type</option><option value="1" data-v-a5853f32>Frontend</option><option value="2" data-v-a5853f32>Backend</option><option value="2" data-v-a5853f32>Testing</option><option value="2" data-v-a5853f32>Devops</option>',5)])],34),[[Z,b.value]])]),e("div",Je,[s[8]||(s[8]=e("label",{class:"form-label me-2 mb-0"},"Concepts",-1)),h(Ne,{style:{width:"100%"},modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=U=>D.value=U),customClass:{"is-invalid":!H.value}},null,8,["modelValue","customClass"])])]),e("div",{class:"modal-footer mt-3"},[e("button",{type:"button",class:"btn btn-secondary",onClick:T}," Cancel "),s[9]||(s[9]=e("button",{type:"submit",class:"btn btn-primary"},"Save",-1))])],32)])])])],32))}}),Ze=O(Ye,[["__scopeId","data-v-a5853f32"]]),et=window.location.hostname==="localhost"?"localhost":window.location.hostname;let B=null;function tt(){return B||(B=pe(`http://${et}:3000`,{transports:["websocket"],autoConnect:!0}),B.on("connect",()=>{console.log("Stack socket connected:",B.id)}),B.on("disconnect",i=>{console.warn("Stack socket disconnected:",i)})),B}let Y=!1;function ot(){if(Y)return;Y=!0;const i=tt(),d=j(),n=G();i.on("stackCreated",l=>{d.glowUser(l.id),n.invalidateQueries({queryKey:["stacks"]})}),i.on("stackUpdated",l=>{d.glowUser(l.id),n.invalidateQueries({queryKey:["stacks"]})}),i.on("stackDeleted",l=>{d.fadeOutUser(l.id),n.invalidateQueries({queryKey:["stacks"]})})}const at={class:"stacks-layout d-flex"},lt={class:"flex-grow-1 d-flex flex-column"},nt={class:"p-4 flex-grow-1"},st={__name:"StacksPage",setup(i){const d=u(null),n=u("Add"),l=u(!1);function o(S="Add",p={}){n.value=S==="Edit"?"Edit":"Add",d.value=S==="Edit"?p:{},l.value=!0}function m(){l.value=!1,d.value=null}ce("openModal",o);const f=de();return Q(()=>f.fullPath,()=>{m()}),ee(()=>{ot()}),(S,p)=>(w(),C("div",at,[e("div",lt,[h(fe),e("main",nt,[h(Le,{onAction:p[0]||(p[0]=c=>o())}),h(ke)])]),(w(),J(ue,{to:"body"},[h(re,{name:"fade",mode:"out-in"},{default:te(()=>[l.value?(w(),J(Ze,{key:0,stackData:d.value,mode:n.value,onClose:m},null,8,["stackData","mode"])):q("",!0)]),_:1})]))]))}},mt=O(st,[["__scopeId","data-v-29cc1466"]]);export{mt as default};
