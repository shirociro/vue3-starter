import{A as U,B as $,g as a,_ as k,c as u,o as l,a as d,t as y,p as x,r as _,C as v,s as h,b as w,k as b,x as E,T as F,D as I,F as C,E as j}from"./index-C-Wx4nDS.js";import{b as M,u as q,a as V,g as A,_ as B,c as L,E as O}from"./Loading-D7qaePDp.js";import{u as D}from"./usersStore-CzbIz2Pa.js";function P(e){return $.post("/users",e)}function Q(e,t){return $.patch(`/users/${e}`,t)}function R(e){return U.delete(`/users/${e}`)}function T(e,t,s,o){const n=new URLSearchParams;return n.append("page",String(e)),n.append("limit",String(t)),console.log(s),s&&n.append("search",s),o!=="all"&&n.append("position",String(o)),U.get(`/users?${n.toString()}`)}async function z(e,t,s,o){try{const{data:n}=await T(e,t,s,o);return console.log("Fetched users data:",n),n}catch(n){throw console.error("Failed to fetch users:",n),n}}async function me(e){const t=new Date().toISOString(),s=new FormData;s.append("firstname",e.firstname),s.append("lastname",e.lastname),s.append("username",e.username),s.append("password",e.password),s.append("position_id",e.position_id),s.append("role_id",e.role_id),s.append("created_at",t),e.profile instanceof File&&s.append("image",e.profile);try{const{data:o}=await P(s);return o}catch(o){throw console.error(" Failed to add user:",o),o}}async function fe(e){new Date().toISOString();const t=new FormData;if(t.append("firstname",e.firstname),t.append("lastname",e.lastname),t.append("username",e.username),t.append("password",e.password),t.append("position_id",e.position_id),t.append("role_id",e.role_id),t.append("profile",e.profile),t.append("remove_profile",e.remove_profile),!e.id)throw new Error("User ID required to update.");try{const{data:s}=await Q(e.id,t);return s}catch(s){throw console.error(" Failed to save user:",s),s}}async function N(e){try{await R(e)}catch(t){throw console.error(" Failed to delete user:",t),t}}function K(e,t,s,o){return M({queryKey:["users",e,t,s,o],queryFn:()=>z(a(e),a(t),a(s),a(o)),keepPreviousData:!0})}const G=["data-id"],H={class:"row g-0"},J={class:"d-flex gap-2 justify-content-end"},W={class:"col-md-4"},X={class:"mb-2",style:{width:"80px",height:"80px",border:"3px solid #4caf50","border-radius":"50%",padding:"2px"}},Y=["src"],Z={key:1,class:"bi bi-person d-flex justify-content-center align-items-center text-secondary",style:{"font-size":"4rem",width:"100%",height:"100%"}},ee={class:"col-md-8"},te={class:"card-body"},se={class:"card-title"},ne={class:"card-text"},oe={class:"card-text"},ae={__name:"UserItem",props:{user:{type:Object,required:!0}},setup(e){const t=D(),s=q();function o(i,r){i.profile==""&&(r.target.style.display="none")}const n=V({mutationFn:i=>N(i),onMutate:i=>{t.fadeEffect(i)},onSuccess:()=>{setTimeout(()=>{s.invalidateQueries({queryKey:["users"]})},1500)},onError:(i,r)=>{console.error(i)}}),p=i=>{n.mutate(i)};return(i,r)=>(l(),u("div",{class:x(["card p-3 mb-3",a(t).fadingEffectIDs.includes(e.user.id)?"fade-out glow-danger":a(t).glowingEffectIDs.includes(e.user.id)?"glow":""]),"data-id":e.user.id},[d("div",H,[d("div",J,[d("button",{onClick:r[0]||(r[0]=m=>i.$emit("action",e.user)),class:"btn btn-sm rounded-circle btn-outline-primary"},[...r[3]||(r[3]=[d("i",{class:"bi bi-pencil"},null,-1)])]),d("button",{onClick:r[1]||(r[1]=m=>p(e.user.id)),class:"btn btn-sm rounded-circle btn-outline-danger"},[...r[4]||(r[4]=[d("i",{class:"bi bi-trash"},null,-1)])])]),d("div",W,[d("div",X,[e.user.profile?(l(),u("img",{key:0,src:a(A)(e.user.profile),alt:"Avatar",class:"rounded-circle",style:{width:"100%",height:"100%","object-fit":"cover"},onError:r[2]||(r[2]=m=>o(e.user,m))},null,40,Y)):(l(),u("i",Z))])]),d("div",ee,[d("div",te,[d("h5",se,y(e.user.firstname)+" "+y(e.user.lastname),1),d("p",ne,"Position: "+y(e.user.position),1),d("p",oe,"Role: "+y(e.user.role),1)])])])],10,G))}},re=k(ae,[["__scopeId","data-v-4bdfe452"]]),ie={class:"users-list-view"},de={key:0,class:"row g-4 align-items-stretch"},le={__name:"UsersList",setup(e){const t=D(),s=_(t.page),o=_(t.limit),{data:n,isLoading:p}=K(s,o,v(()=>t.search),v(()=>t.position)),i=I("openModal");function r(f){i?.("Edit",f)}function m(f){openDeleteModal?.(f)}return(f,g)=>(l(),u("div",ie,[a(p)?(l(),h(L,{key:0})):w("",!0),b(F,{name:"fade-slide",mode:"out-in"},{default:E(()=>[a(n)?.rows?.length&&!a(p)?(l(),u("div",de,[(l(!0),u(C,null,j(a(n)?.rows,c=>(l(),u("div",{key:c.id,class:"col-12 col-sm-6 col-lg-3 user-card"},[b(re,{user:c,mode:"edit",onAction:S=>r(c),onDelete:S=>m(c)},null,8,["user","onAction","onDelete"])]))),128))])):w("",!0)]),_:1}),!a(p)&&!a(n).rows?.length?(l(),h(O,{key:1})):w("",!0),a(n)?.total>o.value?(l(),h(B,{key:2,modelValue:s.value,"onUpdate:modelValue":[g[0]||(g[0]=c=>s.value=c),g[1]||(g[1]=c=>a(t).setPage(s.value))],totalRows:a(n).total,"per-page":o.value},null,8,["modelValue","totalRows","per-page"])):w("",!0)]))}},ge=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{ge as U,le as _,me as c,N as d,fe as u};
